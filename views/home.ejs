<link rel="stylesheet" href="/css/home.css">
<link rel="stylesheet" href="/css/chat_box.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">


<h1>AllSocial</h1>

<section>
    <%if(locals.user) {%>
    <form action="/posts/create" id="new-post-form" method="post">
        <h4>POST</h4>
        <textarea name="content"  cols="30" rows="4" placeholder="type here..." required></textarea>
        <input type="submit" value="submit">
    </form>
    <%}%>

    <div id="post-list-container">
        <h3>All Post</h3>
        <ul>
            <%for (post of postList) {%>
                <%- include('_post') -%>
            <%}%>
        </ul>
    
    </div>
</section>

<!--To display all the friends on home screen-->
<section>
    <%if(locals.user) {%>
    <div id="users-friends">
        <div class="all-users-friends">
            <h2>Friends</h2>
                <!--sendReq has friendships populated in it-->
                <%for (allFriends of sendReq.friendships) {%>
                <ul>       
                    <li>
                        <a href="/users/profile/<%=allFriends.id %>"><%= allFriends.name%></a>
                        <!--it will go to the friends controller to delete the friend-->
                        <form action="/friend/create-friend" method="post">
                            <input type="hidden" name="userId" value="<%=allFriends._id%>">
                            <button type="submit" class="fabutton">
                                <i class="fa-regular fa-circle-xmark"></i>
                            </button>
                        </form>
                    </li>
                </ul>
                <%}%>
            </div>
        <%}%>
    <div class="all-users-friends">
        <h2>All Users</h2>
            <% for (u of all_users) {%>
                <ul>        
                    <li>
                        <a href="/users/profile/<%= u.id %>"><%= u.name%></a>
                    </li>
                </ul>
            <%}%>
        </div>
            
    </div>
    
</section>
<section>
<%- include('_chat_box') -%>
</section>
<script src="/js/home_posts.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.7.2/socket.io.js"></script>
<script src="/js/chat_engine.js"></script>

<%if(locals.user) {%>
<script>
    new ChatEngine('user-chat-box','<%=locals.user.email%>')
</script>
<%}%>